<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>InertiaX | An√°lisis Inteligente</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://sdk.mercadopago.com/js/v2"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
<div class="container py-5">
    <div class="text-center mb-4">
        <img src="{{ url_for('static', filename='LINE.png') }}" class="logo-img" alt="InertiaX Logo">
        <h1 class="mt-3 fw-bold text-primary">InertiaX An√°lisis Autom√°tico</h1>
        <p class="text-muted">Sube tus datos. Deja que nuestra IA haga el resto.</p>
    </div>

    {% if error %}
        <div class="alert alert-danger">{{ error }}</div>
    {% endif %}
    {% if mensaje %}
        <div class="alert alert-success">{{ mensaje }}</div>
    {% endif %}

    <form action="/upload" method="POST" enctype="multipart/form-data" class="card p-4 shadow-sm">
        <div class="row g-3">
            <div class="col-md-6">
                <label class="form-label">Tu nombre o instituci√≥n</label>
                <input type="text" name="nombre" class="form-control" required>
            </div>
            <div class="col-md-6">
                <label class="form-label">Tipo de datos</label>
                <select class="form-select" name="tipo_datos" required>
                    <option value="">Selecciona...</option>
                    <option>Datos de entrenamiento (fuerza, velocidad, potencia)</option>
                    <option>Datos de salto o potencia muscular</option>
                    <option>Datos de laboratorio o pruebas</option>
                    <option>Otro tipo</option>
                </select>
            </div>
            <div class="col-md-6">
                <label class="form-label">Prop√≥sito del an√°lisis</label>
                <select class="form-select" name="proposito" required>
                    <option>Generar reporte editable para deportista</option>
                    <option>Generar an√°lisis estad√≠stico</option>
                    <option>Generar an√°lisis avanzado</option>
                    <option>Todo</option>
                </select>
            </div>
            <div class="col-md-6">
                <label class="form-label">C√≥digo de invitado (opcional)</label>
                <input type="text" name="codigo_invitado" class="form-control" placeholder="Ej: INERTIAXVIP2025">
            </div>
            <div class="col-12">
                <label class="form-label">Detalles adicionales</label>
                <textarea class="form-control" name="detalles" rows="2" placeholder="Describe brevemente tu objetivo..."></textarea>
            </div>
            <div class="col-12">
                <label class="form-label">Archivo CSV o Excel</label>
                <input type="file" name="file" class="form-control" accept=".csv,.xls,.xlsx" required>
            </div>
        </div>
        <div class="text-center mt-4">
            <button class="btn btn-primary btn-lg px-5" type="submit">Subir y analizar</button>
        </div>
    </form>

    {% if table_html %}
        <div class="mt-5">
            <h4 class="fw-semibold">Vista previa de tus datos</h4>
            <div class="table-responsive">{{ table_html | safe }}</div>
        </div>
    {% endif %}

    {% if show_payment %}
        <div class="text-center mt-4">
            <h5>Completa el pago para generar tu reporte</h5>
            <button id="checkout-btn" class="btn btn-success btn-lg mt-2">Pagar con Mercado Pago</button>
        </div>
    {% elif table_html %}
        <div class="text-center mt-4">
            <h5>Tu c√≥digo de invitado fue aceptado üéüÔ∏è</h5>
            <a href="/download_bundle" class="btn btn-primary btn-lg mt-2">Generar y Descargar Reporte</a>
        </div>
    {% endif %}

    <div class="mt-5 text-center">
        <a href="/preview_pdf" target="_blank" class="btn btn-outline-secondary">Vista previa del PDF</a>
    </div>
</div>

<footer class="footer mt-5 py-3 bg-light text-center text-muted">
    <small>¬© 2025 InertiaX SpA ‚Äî Tecnolog√≠a Deportiva Inteligente</small>
</footer>

<script>
{% if show_payment %}
const mp = new MercadoPago("{{ os.getenv('MP_PUBLIC_KEY', 'TEST_PUBLIC_KEY') }}", { locale: 'es-CL' });
document.getElementById("checkout-btn").addEventListener("click", async () => {
    const res = await fetch("/create_preference", { method: "POST" });
    const data = await res.json();
    if (data.id) {
        mp.checkout({ preference: { id: data.id }, autoOpen: true });
    } else {
        alert("Error creando la preferencia de pago.");
    }
});
{% endif %}
</script>

</body>
</html>
